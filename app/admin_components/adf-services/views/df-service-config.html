<div>
    <div class="alert alert-info" ng-show="selectedSchema && apiData.environment.server.ip">
        <li class="fa fa-info-circle"></li>
        The IP address for your DreamFactory instance is <strong>{{ apiData.environment.server.ip }}</strong>. If you have trouble accessing your service through DreamFactory make sure the service allows connections from this IP address.
    </div>

    <div class="form-group" data-ng-repeat="field in selectedSchema.config_schema">
        <div class="form-group ng-scope" data-ng-if="field.type == 'boolean'">
            <div class="checkbox">
                <label>
                    <input id="services_details_config_checkbox_{{$index}}" data-ng-model="serviceInfo.record.config[field.name]" type="checkbox">
                    {{ field.label }}
                </label>
                <df-simple-help data-options="field"></df-simple-help>
            </div>
        </div>


        <div class="form-group ng-scope" data-ng-if="field.type != 'boolean' && field.name !== 'storage_service_id' && field.name !== 'storage_path' && field.name !== 'scm_reference' && field.name !== 'scm_repository'">
            <label>{{ field.label }}</label>
            <df-simple-help data-options="field" data-ng-if="field.description"></df-simple-help>

            <div data-ng-if="field.type == 'text' && field.name == 'content'">
                <label>Import a script file</label>
                <div>
                  <label class="btn btn-default btn-file btn-sm">
                      Select Desktop File... <input type="file" id="services_details_config_filepick_{{$index}}"  style="display: none;" accept="{{allowedConfigFormats}}" onclick="this.value = null;" onchange="angular.element(this).scope().handleFiles(this)" ng-model="filename">
                  </label>
                  <button type="button" id="services_details_config_file_{{$index}}"  class="btn btn-default btn-sm" onclick="angular.element(this).scope().githubModalShowConfig()">Select GitHub File...</button>
                </div>
                <label>Link to a service</label>
                <div>
                    <span>Service: </span>
                    <select id="selected_service" class="input-sm"
                            data-ng-model="selections.service"
                            data-ng-options="item as item.label for item in apiData['service_link'] track by item.id">
                        <option value="">-- None --</option>
                    </select>
                    <span class="form-group" ng-show="selections.service && (selections.service.type === 'github' || selections.service.type === 'gitlab')">
                        <span>Repository: </span>
                        <input size="10" id="selected_service_repo" class="form-inline input-sm" data-ng-model="serviceInfo.record.config.scm_repository" />
                    </span>
                    <span class="form-group" ng-show="selections.service && (selections.service.type === 'github' || selections.service.type === 'gitlab')">
                        <span>Branch/Tag: </span>
                        <input size="10" id="selected_service_ref" class="form-inline input-sm" data-ng-model="serviceInfo.record.config.scm_reference" />
                    </span>
                    <span class="form-group" ng-show="selections.service">
                        <span>Path: </span>
                        <input id="selected_service_path" class="form-inline input-sm" data-ng-model="serviceInfo.record.config.storage_path" />
                    </span>
                    <button type="button" class="btn btn-sm btn-primary"
                            data-ng-show="selections.service"
                            data-ng-click="pullLatestScript()"
                            data-ng-disabled="disableServiceLinkRefresh">
                        <i class="fa fa-refresh"></i> Refresh
                    </button>
                </div>
            </div>
        </div>

        <input class="form-control" data-ng-if="field.type == 'string' && field.name !== 'storage_path' && field.name !== 'scm_reference' && field.name !== 'scm_repository'"
               id="services_details_config_string_{{$index}}"
               data-ng-model="serviceInfo.record.config[field.name]"
               type="text" data-ng-required="field.required"/>

        <input class="form-control" data-ng-if="field.type == 'password' || field.name == 'password'"
               id="services_details_config_password_{{$index}}"
               data-ng-model="serviceInfo.record.config[field.name]"
               type="password" data-ng-required="field.required"/>

        <input class="form-control" data-ng-if="field.type == 'text' && field.name !== 'content' && field.name !== 'password'"
               id="services_details_config_text_{{$index}}"
               data-ng-model="serviceInfo.record.config[field.name]"
               type="text" data-ng-required="field.required"/>

        <df-ace-editor-scripting data-script-type="serviceInfo.record.type" data-current-edit-obj="serviceInfo.record.config[field.name]" data-is-clean="isEditorClean" data-editor="$parent.$parent.editor" data-ng-if="field.type == 'text' && field.name == 'content'"></df-ace-editor-scripting>

        <input class="form-control" data-ng-if="field.type == 'integer' && field.name !== 'storage_service_id'"
               id="services_details_config_integer_{{$index}}"
               data-ng-model="serviceInfo.record.config[field.name]"
               type="number" data-ng-required="field.required">

        <select class="form-control" data-ng-if="field.type == 'picklist'"
                id="services_details_config_picklist_{{$index}}"
                data-ng-model="serviceInfo.record.config[field.name]"
                data-ng-options="option.name as option.label for option in field.values"
                data-ng-change="updateAffectedFields(serviceInfo.record.config[field.name], field)">
        </select>

        <select class="form-control" data-ng-if="field.type == 'reference'"
                id="services_details_config_reference_{{$index}}"
                data-ng-model="serviceInfo.record.config[field.name]"
                data-ng-options="option.value as option.name for option in getReferences(field.ref_table, field.ref_field)"
                data-ng-change="updateAffectedFields(serviceInfo.record.config[field.name], field)">
        </select>

        <df-file-certificate data-ng-if="field.type == 'file_certificate'"
                           data-selected="serviceInfo.record.config[field.name]">
        </df-file-certificate>

        <df-multi-picklist data-ng-if="field.type == 'multi_picklist'"
                           data-cols="field.columns"
                           data-legend="field.legend"
                           data-ng-model="serviceInfo.record.config[field.name]"
                           data-selected-options="serviceInfo.record.config[field.name]"
                           data-options="field.values">
        </df-multi-picklist>

        <div class="panel panel-default" data-ng-if="field.type.indexOf('array') > -1">
            <div class="form-group" data-ng-if="!isArray(field.items)">
                <table class="table table-hover table-striped field-list">
                    <thead>
                    <tr>
                        <th>Values</th>

                        <th class="no-border">
                            <div class="btn-group pull-left">
                                <button type="button" class="btn btn-default btn-sm"
                                        id="services_details_config_array_item_add_{{$index}}"
                                        data-ng-click="appendItemToArray(serviceInfo.record.config, field.name)"
                                        title="Add">
                                    <i class="fa fa-plus fa-fw"></i>
                                </button>
                            </div>
                        </th>
                    </tr>
                    </thead>

                    <tbody>

                    <tr data-ng-repeat="str in serviceInfo.record.config[field.name] track by $index">
                        <td>
                            <input class="form-control"
                                   data-ng-model="serviceInfo.record.config[field.name][$index]"
                                   id="services_details_config_array_item_value_{{$parent.$index}}_{{$index}}"
                                   type="text"/>
                        </td>
                        <td class="no-border">
                            <div class="btn-group pull-left">
                                <button type="button" class="btn btn-default"
                                        data-ng-click="deleteStringFromArray(serviceInfo.record.config[field.name], $index)"
                                        id="services_details_config_array_item_removevalue_{{$parent.$index}}_{{$index}}"
                                        title="Delete">
                                    <i class="fa fa-trash-o fa-fw"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-group" data-ng-if="isArray(field.items)">
                <table class="table table-hover table-striped field-list">
                    <thead>
                    <tr>
                        <th data-ng-repeat="part in field.items">{{ part.label }}</th>

                        <th class="no-border">
                            <div class="btn-group pull-left">
                                <button type="button" class="btn btn-default btn-sm"
                                        id="services_details_config_array_arrayitem_add_{{$index}}"
                                        data-ng-click="appendItemToArray(serviceInfo.record.config, field.name)"
                                        title="Add">
                                    <i class="fa fa-plus fa-fw"></i>
                                </button>
                            </div>
                        </th>
                    </tr>
                    </thead>

                    <tbody>

                    <tr data-ng-repeat="obj in serviceInfo.record.config[field.name] track by $index">
                        <td data-ng-repeat="part in field.items">
                            <input class="form-control" data-ng-if="part.type == 'string'"
                                   id="services_details_config_array_arrayitem_string_{{$parent.$index}}_{{$index}}"
                                   data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                   type="text" data-ng-required="part.required">
                            <input class="form-control" data-ng-if="part.type == 'password'"
                                   id="services_details_config_array_arrayitem_password_{{$parent.$index}}_{{$index}}"
                                   data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                   type="password" data-ng-required="part.required">
                            <input class="form-control" data-ng-if="part.type == 'text'"
                                   id="services_details_config_array_arrayitem_text_{{$parent.$index}}_{{$index}}"
                                   data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                   type="text" data-ng-required="part.required">
                            <input class="checkbox" data-ng-if="part.type == 'boolean'"
                                   id="services_details_config_array_arrayitem_boolean_{{$parent.$index}}_{{$index}}"
                                   data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                   type="checkbox" style="margin-top: 13px">
                            <input class="form-control" data-ng-if="part.type == 'integer'"
                                   id="services_details_config_array_arrayitem_integer_{{$parent.$index}}_{{$index}}"
                                   data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                   type="number" data-ng-required="part.required">

                            <select class="form-control" data-ng-if="part.type == 'picklist'"
                                    id="services_details_config_array_arrayitem_picklist_{{$parent.$index}}_{{$index}}"
                                    data-ng-model="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                    data-ng-options="option.name as option.label for option in part.values"
                                    data-ng-click="updateAffectedFields(serviceInfo.record.config[field.name], field)">
                            </select>
                            <df-grouped-picklist data-ng-if="part.type == 'grouped_picklist'"
                                                 data-options="part.values"
                                                 data-selected="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]">
                            </df-grouped-picklist>
                            <df-event-picker data-ng-if="part.type == 'event_picklist'"
                                             data-options="eventList"
                                             data-selected="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]">
                            </df-event-picker>
                            <df-verb-picker data-ng-if="part.type == 'verb_mask'"
                                            data-allowed-verb-mask="serviceInfo.record.config[field.name][$parent.$parent.$index][part.name]"
                                            data-size="">
                            </df-verb-picker>
                        </td>
                        <td class="no-border">
                            <div class="btn-group pull-left">
                                <button type="button" class="btn btn-default"
                                        data-ng-click="deleteObjectFromArray(serviceInfo.record.config[field.name], $index)"
                                        id="services_details_config_array_arrayitem_remove_{{$parent.$index}}_{{$index}}"
                                        title="Delete">
                                    <i class="fa fa-trash-o fa-fw"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="panel panel-default" data-ng-if="field.type.indexOf('object') > -1">
            <table class="table table-hover table-striped field-list">
                <thead>
                <tr>
                    <th>{{ field.object.key.label }}</th>
                    <th>{{ field.object.value.label }}</th>
                    <th class="no-border">
                        <div class="btn-group pull-left">
                            <button type="button" class="btn btn-default btn-sm"
                                    data-ng-click="addKeyValue(field.name)"
                                    id="services_details_config_object_add_{{$index}}">
                                <i class="fa fa-plus fa-fw"></i>
                            </button>
                        </div>
                    </th>
                </tr>
                </thead>

                <tbody>

                <tr data-ng-repeat="item in serviceInfo.record.config[field.name]">
                    <td>
                        <input id="services_details_config_object_key_{{$parent.$index}}_{{$index}}" class="form-control" data-ng-model="item.key" type="text"/>

                    </td>
                    <td>
                        <input id="services_details_config_object_value_{{$parent.$index}}_{{$index}}" class="form-control" data-ng-model="item.value" type="text"/>

                    </td>

                    <td class="no-border">
                        <div class="btn-group pull-left">
                            <button type="button" class="btn btn-default"
                                    data-ng-click="deleteKeyValue(serviceInfo.record.config[field.name], key)"
                                    id="services_details_config_object_removevalue_{{$parent.$index}}_{{$index}}">
                                <i class="fa fa-trash-o fa-fw"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div data-ng-if="selectedSchema.subscription_required">
        <br/><h4>This feature requires a DreamFactory {{selectedSchema.subscription_type}} product subscription.</h4> Email <a href="mailto:dspsales@dreamfactory.com" >dspsales@dreamfactory.com</a> or call +1-650-641-1800 for pricing information.
    </div>

</div>

<df-github-modal editor="editor" accept="allowedConfigGitFormats" target="serviceTypeConfig"></df-github-modal>
